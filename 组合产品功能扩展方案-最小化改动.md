# ç»„åˆäº§å“åŠŸèƒ½æ‰©å±•æ–¹æ¡ˆ - æœ€å°åŒ–æ”¹åŠ¨ç‰ˆ

> åŸºäºç°æœ‰ `dm_product_info` è¡¨æ‰©å±•ï¼Œæœ€å°åŒ–æ•°æ®åº“å˜æ›´

---

## æ–¹æ¡ˆå¯¹æ¯”æ€»è¡¨

| é¡¹ç›® | æ–¹æ¡ˆä¸€ï¼šæœ€å°åŒ–æ”¹åŠ¨ï¼ˆæ¨èï¼‰â­ | æ–¹æ¡ˆäºŒï¼šJSONå­—æ®µï¼ˆä¸æ¨èï¼‰|
|-----|----------------------|---------------------|
| **æ•°æ®åº“å˜æ›´** | | |
| ä¿®æ”¹ç°æœ‰è¡¨å­—æ®µ | **ä»…å¢åŠ 2ä¸ªå­—æ®µ** | å¢åŠ 3ä¸ªå­—æ®µï¼ˆå«JSONï¼‰ |
| æ–°å¢è¡¨æ•°é‡ | 1å¼ å…³è”è¡¨ | 0å¼ ï¼ˆå®Œå…¨ä¸å¢åŠ ï¼‰ |
| **åŠŸèƒ½ç‰¹æ€§** | | |
| å¤ç”¨ProductInfoåŠŸèƒ½ | âœ… å®Œå…¨å¤ç”¨ | âœ… å®Œå…¨å¤ç”¨ |
| æ•°æ®ä¸€è‡´æ€§ | âœ… å¤–é”®çº¦æŸ | âŒ æ— çº¦æŸ |
| æŸ¥è¯¢æ€§èƒ½ | âœ… ä¼˜ç§€ï¼ˆJOINæŸ¥è¯¢ï¼‰ | âŒ å·®ï¼ˆJSONè§£æï¼‰ |
| SQLæŸ¥è¯¢å­äº§å“ | âœ… æ”¯æŒ | âŒ ä¸æ”¯æŒ |
| **ç»´æŠ¤æ€§** | | |
| æ•°æ®ç»“æ„æ¸…æ™°åº¦ | âœ… æ¸…æ™° | âš ï¸ ä¸€èˆ¬ |
| æ‰©å±•æ€§ | âœ… æ˜“æ‰©å±• | âŒ å›°éš¾ |
| ç»´æŠ¤éš¾åº¦ | âœ… ç®€å• | âš ï¸ å¤æ‚ |
| **æ¨èåº¦** | â­â­â­â­â­ | â­â­ |

---

## æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆä¸€ï¼šåªå¢åŠ ä¸€å¼ æ˜ç»†è¡¨ï¼ˆæ¨èï¼‰â­
- âœ… æœ€å°åŒ–æ”¹åŠ¨ï¼Œåªéœ€1å¼ æ–°è¡¨ + 2ä¸ªå­—æ®µ
- âœ… ç»„åˆäº§å“å¯ä»¥å¤ç”¨ç°æœ‰ProductInfoçš„æ‰€æœ‰åŠŸèƒ½
- âœ… æ•°æ®ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤
- âœ… **å¤ç”¨ cost_price å­—æ®µï¼Œæ— éœ€é¢å¤–æˆæœ¬ä»·å­—æ®µ**
- âŒ éœ€è¦æ–°å¢1å¼ è¡¨

### æ–¹æ¡ˆäºŒï¼šå®Œå…¨ä¸å¢åŠ è¡¨ï¼ˆJSONå­—æ®µæ–¹æ¡ˆï¼‰
- âœ… å®Œå…¨ä¸éœ€è¦æ–°è¡¨
- âŒ JSONå­—æ®µæŸ¥è¯¢æ€§èƒ½å·®
- âŒ æ— æ³•å»ºç«‹å¤–é”®çº¦æŸ
- âŒ æ•°æ®ä¸€è‡´æ€§éš¾ä»¥ä¿è¯
- âš ï¸ **ä¸æ¨è**ï¼Œé™¤éæœ‰ç‰¹æ®Šé™åˆ¶

---

## æ–¹æ¡ˆä¸€ï¼šæœ€å°åŒ–æ”¹åŠ¨æ–¹æ¡ˆï¼ˆæ¨èï¼‰

### ä¸€ã€è¡¨ç»“æ„è®¾è®¡

#### 1.1 ä¿®æ”¹ç°æœ‰è¡¨ `dm_product_info`

```sql
-- åœ¨ dm_product_info è¡¨ä¸­æ·»åŠ å­—æ®µï¼ˆåªéœ€2ä¸ªå­—æ®µï¼ï¼‰
ALTER TABLE `dm_product_info` 
ADD COLUMN `product_type` int DEFAULT 0 COMMENT 'äº§å“ç±»å‹ï¼š0=æ™®é€šäº§å“ 1=ç»„åˆäº§å“',
ADD COLUMN `bundle_type` int DEFAULT NULL COMMENT 'ç»„åˆç±»å‹ï¼š1=è‡ªå®šä¹‰æˆæœ¬ä»· 2=è‡ªåŠ¨ç´¯è®¡æˆæœ¬ä»·ï¼ˆä»…ç»„åˆäº§å“æœ‰æ•ˆï¼‰',
ADD INDEX `idx_product_type` (`product_type`, `deleted`);

-- è¯´æ˜ï¼š
-- product_type = 0: æ™®é€šäº§å“ï¼ˆé»˜è®¤ï¼‰
-- product_type = 1: ç»„åˆäº§å“
-- bundle_type = 1: è‡ªå®šä¹‰æˆæœ¬ä»·ï¼ˆcost_priceç”±ç”¨æˆ·æ‰‹åŠ¨è®¾ç½®ï¼‰
-- bundle_type = 2: è‡ªåŠ¨ç´¯è®¡æˆæœ¬ä»·ï¼ˆcost_priceè‡ªåŠ¨è®¡ç®—ï¼‰
-- cost_price å­—æ®µï¼šã€å¤ç”¨åŸæœ‰å­—æ®µã€‘å­˜å‚¨æœ€ç»ˆæˆæœ¬ä»·
```

**å­—æ®µè¯´æ˜ï¼š**
- `product_type`: æ ‡è¯†äº§å“ç±»å‹ï¼Œ0=æ™®é€šäº§å“ï¼Œ1=ç»„åˆäº§å“
- `bundle_type`: ä»…ç»„åˆäº§å“ä½¿ç”¨ï¼Œå†³å®šæˆæœ¬ä»·è®¡ç®—æ–¹å¼
  - 1 = è‡ªå®šä¹‰æ¨¡å¼ï¼š`cost_price` ç”±ç”¨æˆ·æ‰‹åŠ¨è®¾ç½®ï¼Œä¸éšå­äº§å“æˆæœ¬å˜åŒ–
  - 2 = è‡ªåŠ¨ç´¯è®¡æ¨¡å¼ï¼š`cost_price` è‡ªåŠ¨è®¡ç®—ï¼ˆå­äº§å“æˆæœ¬ä¹‹å’Œï¼‰
- `cost_price`: **å¤ç”¨åŸæœ‰å­—æ®µ**ï¼Œå­˜å‚¨æœ€ç»ˆæˆæœ¬ä»·ï¼ˆæ— éœ€é¢å¤–å­—æ®µï¼‰

#### 1.2 æ–°å¢å…³è”è¡¨ `dm_product_bundle_relation`ï¼ˆå”¯ä¸€æ–°å¢è¡¨ï¼‰

```sql
-- ç»„åˆäº§å“å…³è”è¡¨ï¼ˆåªå­˜å‚¨å…³è”å…³ç³»ï¼Œä¸å†—ä½™æ•°æ®ï¼‰
CREATE TABLE `dm_product_bundle_relation` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  
  -- å…³è”å…³ç³»ï¼ˆæ ¸å¿ƒï¼‰
  `bundle_product_id` bigint NOT NULL COMMENT 'ç»„åˆäº§å“IDï¼ˆdm_product_info.idï¼‰',
  `sub_product_id` bigint NOT NULL COMMENT 'å­äº§å“IDï¼ˆdm_product_info.idï¼‰',
  
  -- ç»„åˆé…ç½®
  `quantity` int NOT NULL DEFAULT 1 COMMENT 'æ•°é‡',
  `sort_order` int DEFAULT 0 COMMENT 'æ’åº',
  `remark` varchar(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
  
  -- å®¡è®¡å­—æ®µ
  `creator` varchar(64) DEFAULT NULL COMMENT 'åˆ›å»ºäºº',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updater` varchar(64) DEFAULT NULL COMMENT 'æ›´æ–°äºº',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `deleted` bit(1) NOT NULL DEFAULT b'0' COMMENT 'æ˜¯å¦åˆ é™¤',
  `tenant_id` bigint DEFAULT 0 COMMENT 'ç§Ÿæˆ·ID',
  
  PRIMARY KEY (`id`),
  KEY `idx_bundle_product` (`bundle_product_id`, `deleted`),
  KEY `idx_sub_product` (`sub_product_id`),
  KEY `idx_tenant` (`tenant_id`, `deleted`),
  UNIQUE KEY `uk_bundle_sub` (`bundle_product_id`, `sub_product_id`, `deleted`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COMMENT='äº§å“ç»„åˆå…³ç³»è¡¨';
```

**è®¾è®¡åŸåˆ™ï¼š**
- âœ… **ä¸å­˜å‚¨å†—ä½™æ•°æ®**ï¼šå­äº§å“çš„ SKUã€åç§°ã€å•ä»·ç­‰ä¿¡æ¯éƒ½ä» `dm_product_info` å®æ—¶è·å–
- âœ… **æ•°æ®ä¸€è‡´æ€§**ï¼šå­äº§å“ä¿¡æ¯å˜æ›´æ—¶ï¼ŒæŸ¥è¯¢è‡ªåŠ¨åæ˜ æœ€æ–°æ•°æ®
- âœ… **è¡¨ç»“æ„ç²¾ç®€**ï¼šåªå­˜å‚¨å…³è”å…³ç³»å’Œé…ç½®ä¿¡æ¯
- âœ… **æ€§èƒ½è€ƒè™‘**ï¼šé€šè¿‡ JOIN æŸ¥è¯¢è·å–å®Œæ•´ä¿¡æ¯

**ä¼˜åŠ¿ï¼š**
- ç»„åˆäº§å“æœ¬èº«å°±æ˜¯ä¸€æ¡ `dm_product_info` è®°å½•
- å¯ä»¥å¤ç”¨ç°æœ‰çš„åˆ†ç±»ã€å“ç‰Œã€ä¾›åº”å•†ç­‰æ‰€æœ‰åŠŸèƒ½
- åªéœ€è¦1å¼ å…³è”è¡¨æ¥ç»´æŠ¤ç»„åˆå…³ç³»
- å­äº§å“ä¿¡æ¯å˜æ›´è‡ªåŠ¨ç”Ÿæ•ˆï¼Œæ— éœ€åŒæ­¥

---

### äºŒã€æ•°æ®æ¨¡å‹è®¾è®¡

#### 2.1 ä¿®æ”¹ç°æœ‰ ProductInfoDO

```java
@TableName("dm_product_info")
@Data
@EqualsAndHashCode(callSuper = true)
public class ProductInfoDO extends BaseDO {

    private Long id;
    private String skuId;
    private String skuName;
    // ... å…¶ä»–åŸæœ‰å­—æ®µ ...
    private BigDecimal costPrice;  // æœ€ç»ˆæˆæœ¬ä»·ï¼ˆå¤ç”¨åŸæœ‰å­—æ®µï¼‰
    
    // ========== æ–°å¢å­—æ®µï¼ˆåªéœ€2ä¸ªï¼ï¼‰ ==========
    
    /**
     * äº§å“ç±»å‹ï¼š0=æ™®é€šäº§å“ 1=ç»„åˆäº§å“
     */
    private Integer productType;
    
    /**
     * ç»„åˆç±»å‹ï¼š1=è‡ªå®šä¹‰æˆæœ¬ä»· 2=è‡ªåŠ¨ç´¯è®¡æˆæœ¬ä»·
     * ï¼ˆä»…å½“ productType=1 æ—¶æœ‰æ•ˆï¼‰
     */
    private Integer bundleType;
    
    // æ³¨æ„ï¼šcost_price å­—æ®µå¤ç”¨ï¼Œæ— éœ€é¢å¤–å­—æ®µå­˜å‚¨æˆæœ¬ä»·
}
```

#### 2.2 æ–°å¢ ProductBundleRelationDOï¼ˆç²¾ç®€ç‰ˆï¼‰

```java
package cn.iocoder.yudao.module.dm.dal.dataobject.product;

import cn.iocoder.yudao.framework.tenant.core.db.TenantBaseDO;
import com.baomidou.mybatisplus.annotation.*;
import lombok.*;

/**
 * äº§å“ç»„åˆå…³ç³» DO
 * 
 * è®¾è®¡åŸåˆ™ï¼šåªå­˜å‚¨å…³è”å…³ç³»ï¼Œä¸å†—ä½™å­˜å‚¨å­äº§å“ä¿¡æ¯
 * å­äº§å“çš„è¯¦ç»†ä¿¡æ¯é€šè¿‡ JOIN dm_product_info è¡¨è·å–
 *
 * @author zeno
 */
@TableName("dm_product_bundle_relation")
@KeySequence("dm_product_bundle_relation_seq")
@Data
@EqualsAndHashCode(callSuper = true)
@ToString(callSuper = true)
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class ProductBundleRelationDO extends TenantBaseDO {

    /**
     * ä¸»é”®
     */
    @TableId
    private Long id;
    
    /**
     * ç»„åˆäº§å“IDï¼ˆdm_product_info.idï¼‰
     */
    private Long bundleProductId;
    
    /**
     * å­äº§å“IDï¼ˆdm_product_info.idï¼‰
     */
    private Long subProductId;
    
    /**
     * æ•°é‡
     */
    private Integer quantity;
    
    /**
     * æ’åº
     */
    private Integer sortOrder;
    
    /**
     * å¤‡æ³¨
     */
    private String remark;
    
    // æ³¨æ„ï¼šå­äº§å“çš„ SKUã€åç§°ã€å•ä»·ç­‰ä¿¡æ¯ä¸åœ¨æ­¤è¡¨å­˜å‚¨
    // æŸ¥è¯¢æ—¶é€šè¿‡ JOIN dm_product_info è¡¨è·å–å®æ—¶æ•°æ®
}
```

---

### ä¸‰ã€VOå±‚è®¾è®¡

#### 3.1 æ‰©å±•ç°æœ‰ ProductInfoSaveReqVO

```java
@Schema(description = "ç®¡ç†åå° - äº§å“ä¿¡æ¯æ–°å¢/ä¿®æ”¹ Request VO")
@Data
public class ProductInfoSaveReqVO {

    private Long id;
    private String skuId;
    private String skuName;
    // ... å…¶ä»–åŸæœ‰å­—æ®µ ...
    private BigDecimal costPrice;
    
    // ========== æ–°å¢ï¼šç»„åˆäº§å“ç›¸å…³å­—æ®µ ==========
    
    @Schema(description = "äº§å“ç±»å‹ï¼š0=æ™®é€šäº§å“ 1=ç»„åˆäº§å“")
    private Integer productType;
    
    @Schema(description = "ç»„åˆç±»å‹ï¼š1=è‡ªå®šä¹‰æˆæœ¬ä»· 2=è‡ªåŠ¨ç´¯è®¡æˆæœ¬ä»·")
    private Integer bundleType;
    
    @Schema(description = "ç»„åˆäº§å“æ˜ç»†åˆ—è¡¨ï¼ˆä»…productType=1æ—¶å¡«å†™ï¼‰")
    @Valid
    private List<ProductBundleItemReqVO> bundleItems;
    
    // æ³¨æ„ï¼šcostPriceå­—æ®µå¤ç”¨
    // - bundleType=1æ—¶ï¼šç”¨æˆ·æ‰‹åŠ¨è®¾ç½®costPrice
    // - bundleType=2æ—¶ï¼šç³»ç»Ÿè‡ªåŠ¨è®¡ç®—costPriceï¼ˆåŸºäºbundleItemsï¼‰
    
    // ... å…¶ä»–åŸæœ‰å­—æ®µ ...
}
```

#### 3.2 æ–°å¢ ProductBundleItemReqVO

```java
@Schema(description = "ç»„åˆäº§å“æ˜ç»†")
@Data
public class ProductBundleItemReqVO {
    
    @Schema(description = "å­äº§å“ID", requiredMode = Schema.RequiredMode.REQUIRED)
    @NotNull(message = "å­äº§å“IDä¸èƒ½ä¸ºç©º")
    private Long subProductId;
    
    @Schema(description = "æ•°é‡", requiredMode = Schema.RequiredMode.REQUIRED)
    @NotNull(message = "æ•°é‡ä¸èƒ½ä¸ºç©º")
    @Min(value = 1, message = "æ•°é‡è‡³å°‘ä¸º1")
    private Integer quantity;
    
    @Schema(description = "æ’åº")
    private Integer sortOrder;
    
    @Schema(description = "å¤‡æ³¨")
    private String remark;
}
```

#### 3.3 æ‰©å±•ç°æœ‰ ProductInfoRespVO

```java
@Schema(description = "ç®¡ç†åå° - äº§å“ä¿¡æ¯ Response VO")
@Data
public class ProductInfoRespVO {
    
    private Long id;
    private String skuId;
    private String skuName;
    // ... å…¶ä»–åŸæœ‰å­—æ®µ ...
    private BigDecimal costPrice;
    
    // ========== æ–°å¢ï¼šç»„åˆäº§å“ç›¸å…³å­—æ®µ ==========
    
    @Schema(description = "äº§å“ç±»å‹ï¼š0=æ™®é€šäº§å“ 1=ç»„åˆäº§å“")
    private Integer productType;
    
    @Schema(description = "ç»„åˆç±»å‹")
    private Integer bundleType;
    
    @Schema(description = "ç»„åˆäº§å“æ˜ç»†åˆ—è¡¨ï¼ˆä»…ç»„åˆäº§å“ï¼‰")
    private List<ProductBundleItemRespVO> bundleItems;
    
    // ... å…¶ä»–åŸæœ‰å­—æ®µ ...
}
```

#### 3.4 æ–°å¢ ProductBundleItemRespVO

```java
@Schema(description = "ç»„åˆäº§å“æ˜ç»†å“åº”")
@Data
public class ProductBundleItemRespVO {
    
    @Schema(description = "å…³ç³»ID")
    private Long id;
    
    @Schema(description = "å­äº§å“ID")
    private Long subProductId;
    
    // ========== ä»¥ä¸‹å­—æ®µä» dm_product_info è¡¨ JOIN è·å–ï¼ˆå®æ—¶æ•°æ®ï¼‰==========
    
    @Schema(description = "å­äº§å“SKUï¼ˆå®æ—¶ï¼‰")
    private String subSkuId;
    
    @Schema(description = "å­äº§å“åç§°ï¼ˆå®æ—¶ï¼‰")
    private String subSkuName;
    
    @Schema(description = "å•ä½ï¼ˆå®æ—¶ï¼‰")
    private String unit;
    
    @Schema(description = "å•ä½æˆæœ¬ä»·ï¼ˆå®æ—¶ï¼‰")
    private BigDecimal unitCostPrice;
    
    // ========== ä»¥ä¸‹å­—æ®µä»å…³ç³»è¡¨è·å– ==========
    
    @Schema(description = "æ•°é‡")
    private Integer quantity;
    
    @Schema(description = "æ€»æˆæœ¬ä»·ï¼ˆè®¡ç®—ï¼šunitCostPrice * quantityï¼‰")
    private BigDecimal totalCostPrice;
    
    @Schema(description = "æ’åº")
    private Integer sortOrder;
    
    @Schema(description = "å¤‡æ³¨")
    private String remark;
}
```

---

### å››ã€Serviceå±‚å®ç°ï¼ˆæ‰©å±•ç°æœ‰ ProductInfoServiceï¼‰

```java
public interface ProductInfoService {
    
    // ========== ç°æœ‰æ–¹æ³• ==========
    Long createProductInfo(@Valid ProductInfoSaveReqVO createReqVO);
    void updateProductInfo(@Valid ProductInfoSaveReqVO updateReqVO);
    // ... å…¶ä»–ç°æœ‰æ–¹æ³• ...
    
    // ========== æ–°å¢ï¼šç»„åˆäº§å“ç›¸å…³æ–¹æ³• ==========
    
    /**
     * è·å–ç»„åˆäº§å“çš„æ˜ç»†åˆ—è¡¨
     *
     * @param bundleProductId ç»„åˆäº§å“ID
     * @return æ˜ç»†åˆ—è¡¨
     */
    List<ProductBundleRelationDO> getBundleRelations(Long bundleProductId);
    
    /**
     * é‡æ–°è®¡ç®—ç»„åˆäº§å“æˆæœ¬ä»·
     *
     * @param bundleProductId ç»„åˆäº§å“ID
     */
    void recalculateBundleCostPrice(Long bundleProductId);
    
    /**
     * æ‰¹é‡é‡æ–°è®¡ç®—ç»„åˆäº§å“æˆæœ¬ä»·ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰
     */
    void batchRecalculateBundleCostPrice();
}
```

#### 4.1 Serviceå®ç°å…³é”®ä»£ç 

```java
@Service
@Validated
@Slf4j
public class ProductInfoServiceImpl implements ProductInfoService {

    @Resource
    private ProductInfoMapper productInfoMapper;
    
    @Resource
    private ProductBundleRelationMapper bundleRelationMapper;
    
    // å…¶ä»–ç°æœ‰ä¾èµ–...

    @Override
    @Transactional(rollbackFor = Exception.class)
    public Long createProductInfo(@Valid ProductInfoSaveReqVO createReqVO) {
        // 1. åŸæœ‰çš„åˆ›å»ºé€»è¾‘...
        ProductInfoDO product = BeanUtils.toBean(createReqVO, ProductInfoDO.class);
        
        // 2. å¦‚æœæ˜¯ç»„åˆäº§å“ï¼Œéœ€è¦é¢å¤–å¤„ç†
        if (createReqVO.getProductType() != null && createReqVO.getProductType() == 1) {
            // 2.1 æ ¡éªŒç»„åˆäº§å“æ•°æ®
            validateBundleProduct(createReqVO);
            
            // 2.2 åˆ›å»ºæ˜ç»†
            List<ProductBundleRelationDO> relations = createBundleRelations(null, createReqVO.getBundleItems());
            
            // 2.3 è®¡ç®—æœ€ç»ˆæˆæœ¬ä»·
            BigDecimal finalCostPrice = calculateBundleCostPrice(
                createReqVO.getBundleType(), 
                createReqVO.getCustomCostPrice(), 
                relations
            );
            
            // è®¾ç½®æœ€ç»ˆæˆæœ¬ä»·åˆ° cost_price å­—æ®µ
            product.setCostPrice(finalCostPrice);
        }
        
        // 3. æ’å…¥ä¸»è®°å½•
        productInfoMapper.insert(product);
        Long productId = product.getId();
        
        // 4. å¦‚æœæ˜¯ç»„åˆäº§å“ï¼Œæ’å…¥æ˜ç»†
        if (createReqVO.getProductType() != null && createReqVO.getProductType() == 1) {
            List<ProductBundleRelationDO> relations = createBundleRelations(productId, createReqVO.getBundleItems());
            relations.forEach(bundleRelationMapper::insert);
        }
        
        // 5. åŸæœ‰çš„å…¶ä»–å­è¡¨å¤„ç†...
        // productCustoms, productPrices, etc.
        
        return productId;
    }

    @Override
    @Transactional(rollbackFor = Exception.class)
    public void updateProductInfo(@Valid ProductInfoSaveReqVO updateReqVO) {
        // 1. æ ¡éªŒå­˜åœ¨
        validateProductInfoExists(updateReqVO.getId());
        
        // 2. æ›´æ–°ä¸»è®°å½•
        ProductInfoDO updateObj = BeanUtils.toBean(updateReqVO, ProductInfoDO.class);
        
        // 3. å¦‚æœæ˜¯ç»„åˆäº§å“ï¼Œé‡æ–°å¤„ç†æ˜ç»†
        if (updateReqVO.getProductType() != null && updateReqVO.getProductType() == 1) {
            // 3.1 æ ¡éªŒ
            validateBundleProduct(updateReqVO);
            
            // 3.2 åˆ é™¤æ—§æ˜ç»†
            bundleRelationMapper.deleteByBundleProductId(updateReqVO.getId());
            
            // 3.3 åˆ›å»ºæ–°æ˜ç»†
            List<ProductBundleRelationDO> relations = createBundleRelations(
                updateReqVO.getId(), 
                updateReqVO.getBundleItems()
            );
            
            // 3.4 é‡æ–°è®¡ç®—æˆæœ¬ä»·
            BigDecimal finalCostPrice = calculateBundleCostPrice(
                updateReqVO.getBundleType(), 
                updateReqVO.getCostPrice(),  // bundleType=1æ—¶ï¼Œç”¨æˆ·ä¼ å…¥çš„cost_price
                relations
            );
            
            // è®¾ç½®æœ€ç»ˆæˆæœ¬ä»·
            updateObj.setCostPrice(finalCostPrice);
            
            // 3.5 æ’å…¥æ–°æ˜ç»†
            relations.forEach(bundleRelationMapper::insert);
        }
        
        // 4. æ›´æ–°æ•°æ®åº“
        productInfoMapper.updateById(updateObj);
        
        // 5. åŸæœ‰çš„å…¶ä»–å­è¡¨å¤„ç†...
    }

    @Override
    public ProductInfoRespVO getProductInfo(Long id) {
        // 1. æŸ¥è¯¢äº§å“åŸºæœ¬ä¿¡æ¯
        ProductInfoDO product = productInfoMapper.selectById(id);
        if (product == null) {
            return null;
        }
        
        ProductInfoRespVO respVO = BeanUtils.toBean(product, ProductInfoRespVO.class);
        
        // 2. å¦‚æœæ˜¯ç»„åˆäº§å“ï¼ŒæŸ¥è¯¢æ˜ç»†å¹¶å…³è”å­äº§å“ä¿¡æ¯
        if (product.getProductType() != null && product.getProductType() == 1) {
            List<ProductBundleRelationDO> relations = bundleRelationMapper
                    .selectListByBundleProductId(id);
            
            // 3. ç»„è£…æ˜ç»†æ•°æ®ï¼ˆå®æ—¶è·å–å­äº§å“ä¿¡æ¯ï¼‰
            List<ProductBundleItemRespVO> itemRespVOs = new ArrayList<>();
            
            for (ProductBundleRelationDO relation : relations) {
                // å®æ—¶æŸ¥è¯¢å­äº§å“ä¿¡æ¯
                ProductInfoDO subProduct = productInfoMapper.selectById(relation.getSubProductId());
                if (subProduct != null) {
                    ProductBundleItemRespVO itemRespVO = new ProductBundleItemRespVO();
                    itemRespVO.setId(relation.getId());
                    itemRespVO.setSubProductId(relation.getSubProductId());
                    itemRespVO.setQuantity(relation.getQuantity());
                    itemRespVO.setSortOrder(relation.getSortOrder());
                    itemRespVO.setRemark(relation.getRemark());
                    
                    // ä»å­äº§å“è·å–å®æ—¶ä¿¡æ¯
                    itemRespVO.setSubSkuId(subProduct.getSkuId());
                    itemRespVO.setSubSkuName(subProduct.getSkuName());
                    itemRespVO.setUnit(subProduct.getUnit());
                    itemRespVO.setUnitCostPrice(subProduct.getCostPrice());
                    
                    // è®¡ç®—æ€»æˆæœ¬ä»·
                    if (subProduct.getCostPrice() != null) {
                        itemRespVO.setTotalCostPrice(
                            subProduct.getCostPrice().multiply(new BigDecimal(relation.getQuantity()))
                        );
                    }
                    
                    itemRespVOs.add(itemRespVO);
                }
            }
            
            respVO.setBundleItems(itemRespVOs);
        }
        
        return respVO;
    }

    @Override
    public List<ProductBundleRelationDO> getBundleRelations(Long bundleProductId) {
        return bundleRelationMapper.selectListByBundleProductId(bundleProductId);
    }

    @Override
    @Transactional(rollbackFor = Exception.class)
    public void recalculateBundleCostPrice(Long bundleProductId) {
        // 1. è·å–äº§å“
        ProductInfoDO product = productInfoMapper.selectById(bundleProductId);
        if (product == null || product.getProductType() != 1) {
            throw exception(PRODUCT_NOT_BUNDLE);
        }
        
        // 2. ä»…è‡ªåŠ¨ç´¯è®¡æ¨¡å¼éœ€è¦é‡ç®—
        if (product.getBundleType() != 2) {
            log.warn("[recalculateBundleCostPrice] äº§å“{}ä¸ºè‡ªå®šä¹‰æˆæœ¬ä»·æ¨¡å¼ï¼Œè·³è¿‡", bundleProductId);
            return;
        }
        
        // 3. è·å–å…³è”å…³ç³»
        List<ProductBundleRelationDO> relations = bundleRelationMapper.selectListByBundleProductId(bundleProductId);
        
        // 4. å®æ—¶æŸ¥è¯¢å­äº§å“æˆæœ¬ä»·å¹¶è®¡ç®—æ€»æˆæœ¬
        BigDecimal totalCost = BigDecimal.ZERO;
        
        for (ProductBundleRelationDO relation : relations) {
            // å®æ—¶è·å–å­äº§å“ä¿¡æ¯ï¼ˆä¸å­˜å‚¨å¿«ç…§ï¼‰
            ProductInfoDO subProduct = productInfoMapper.selectById(relation.getSubProductId());
            if (subProduct != null && subProduct.getCostPrice() != null) {
                // è®¡ç®—è¯¥é¡¹æˆæœ¬ï¼šå•ä»· * æ•°é‡
                BigDecimal itemCost = subProduct.getCostPrice()
                        .multiply(new BigDecimal(relation.getQuantity()));
                totalCost = totalCost.add(itemCost);
            }
        }
        
        // 5. æ›´æ–°äº§å“æˆæœ¬ä»·
        ProductInfoDO updateObj = new ProductInfoDO();
        updateObj.setId(bundleProductId);
        updateObj.setCostPrice(totalCost);
        productInfoMapper.updateById(updateObj);
        
        log.info("[recalculateBundleCostPrice] é‡æ–°è®¡ç®—æˆæœ¬ä»·æˆåŠŸï¼ŒID={}, æ–°æˆæœ¬ä»·={}", 
                 bundleProductId, totalCost);
    }

    @Override
    @Transactional(rollbackFor = Exception.class)
    public void batchRecalculateBundleCostPrice() {
        // æŸ¥è¯¢æ‰€æœ‰è‡ªåŠ¨ç´¯è®¡æ¨¡å¼çš„ç»„åˆäº§å“
        List<ProductInfoDO> bundleProducts = productInfoMapper.selectListByProductTypeAndBundleType(1, 2);
        
        for (ProductInfoDO product : bundleProducts) {
            try {
                recalculateBundleCostPrice(product.getId());
            } catch (Exception e) {
                log.error("[batchRecalculateBundleCostPrice] é‡æ–°è®¡ç®—äº§å“{}æˆæœ¬ä»·å¤±è´¥", 
                          product.getId(), e);
            }
        }
        
        log.info("[batchRecalculateBundleCostPrice] æ‰¹é‡é‡æ–°è®¡ç®—å®Œæˆï¼Œå…±{}ä¸ª", bundleProducts.size());
    }

    // ==================== ç§æœ‰æ–¹æ³• ====================

    /**
     * æ ¡éªŒç»„åˆäº§å“æ•°æ®
     */
    private void validateBundleProduct(ProductInfoSaveReqVO reqVO) {
        if (reqVO.getBundleType() == null) {
            throw exception(BUNDLE_TYPE_REQUIRED);
        }
        
        // è‡ªå®šä¹‰æ¨¡å¼æ—¶ï¼Œå¿…é¡»ä¼ å…¥ costPrice
        if (reqVO.getBundleType() == 1 && reqVO.getCostPrice() == null) {
            throw exception(COST_PRICE_REQUIRED);
        }
        
        if (CollectionUtils.isEmpty(reqVO.getBundleItems())) {
            throw exception(BUNDLE_ITEMS_REQUIRED);
        }
        
        // æ ¡éªŒå­äº§å“æ˜¯å¦å­˜åœ¨
        for (ProductBundleItemReqVO item : reqVO.getBundleItems()) {
            ProductInfoDO subProduct = productInfoMapper.selectById(item.getSubProductId());
            if (subProduct == null) {
                throw exception(SUB_PRODUCT_NOT_EXISTS, item.getSubProductId());
            }
            
            // é˜²æ­¢ç»„åˆäº§å“åµŒå¥—ï¼ˆå¯é€‰ï¼‰
            if (subProduct.getProductType() != null && subProduct.getProductType() == 1) {
                throw exception(BUNDLE_PRODUCT_CANNOT_NEST);
            }
        }
    }

    /**
     * åˆ›å»ºç»„åˆå…³ç³»ï¼ˆç²¾ç®€ç‰ˆï¼šåªå­˜å‚¨å…³è”å…³ç³»ï¼‰
     */
    private List<ProductBundleRelationDO> createBundleRelations(Long bundleProductId, 
                                                                List<ProductBundleItemReqVO> itemReqVOs) {
        List<ProductBundleRelationDO> relations = new ArrayList<>();
        
        for (ProductBundleItemReqVO itemReqVO : itemReqVOs) {
            // åˆ›å»ºå…³ç³»ï¼ˆåªå­˜å‚¨å…³è”ä¿¡æ¯ï¼Œä¸å­˜å‚¨å†—ä½™æ•°æ®ï¼‰
            ProductBundleRelationDO relation = ProductBundleRelationDO.builder()
                    .bundleProductId(bundleProductId)
                    .subProductId(itemReqVO.getSubProductId())
                    .quantity(itemReqVO.getQuantity())
                    .sortOrder(itemReqVO.getSortOrder() != null ? itemReqVO.getSortOrder() : 0)
                    .remark(itemReqVO.getRemark())
                    .build();
            
            relations.add(relation);
        }
        
        return relations;
    }

    /**
     * è®¡ç®—ç»„åˆäº§å“æˆæœ¬ä»·
     * 
     * @param bundleType ç»„åˆç±»å‹ï¼š1=è‡ªå®šä¹‰ 2=è‡ªåŠ¨ç´¯è®¡
     * @param userInputCostPrice ç”¨æˆ·è¾“å…¥çš„æˆæœ¬ä»·ï¼ˆbundleType=1æ—¶ä½¿ç”¨ï¼‰
     * @param relations ç»„åˆäº§å“æ˜ç»†
     * @return æœ€ç»ˆæˆæœ¬ä»·
     */
    private BigDecimal calculateBundleCostPrice(Integer bundleType, 
                                               BigDecimal userInputCostPrice, 
                                               List<ProductBundleRelationDO> relations) {
        if (bundleType == 1) {
            // è‡ªå®šä¹‰æˆæœ¬ä»·æ¨¡å¼ï¼šç›´æ¥ä½¿ç”¨ç”¨æˆ·è¾“å…¥çš„å€¼
            return userInputCostPrice;
        } else {
            // è‡ªåŠ¨ç´¯è®¡æ¨¡å¼ï¼šå®æ—¶æŸ¥è¯¢å­äº§å“æˆæœ¬ä»·å¹¶ç´¯åŠ 
            BigDecimal totalCost = BigDecimal.ZERO;
            
            for (ProductBundleRelationDO relation : relations) {
                // å®æ—¶è·å–å­äº§å“ä¿¡æ¯
                ProductInfoDO subProduct = productInfoMapper.selectById(relation.getSubProductId());
                if (subProduct != null && subProduct.getCostPrice() != null) {
                    // è®¡ç®—è¯¥é¡¹æˆæœ¬ï¼šå•ä»· * æ•°é‡
                    BigDecimal itemCost = subProduct.getCostPrice()
                            .multiply(new BigDecimal(relation.getQuantity()));
                    totalCost = totalCost.add(itemCost);
                }
            }
            
            return totalCost;
        }
    }
}
```

---

### äº”ã€Mapperå±‚

#### 5.1 æ‰©å±•ç°æœ‰ ProductInfoMapper

```java
@Mapper
public interface ProductInfoMapper extends BaseMapperX<ProductInfoDO> {
    
    // ========== ç°æœ‰æ–¹æ³• ==========
    // ... 
    
    // ========== æ–°å¢æ–¹æ³• ==========
    
    /**
     * æŸ¥è¯¢æŒ‡å®šç±»å‹å’Œç»„åˆç±»å‹çš„äº§å“åˆ—è¡¨
     */
    default List<ProductInfoDO> selectListByProductTypeAndBundleType(Integer productType, Integer bundleType) {
        return selectList(new LambdaQueryWrapperX<ProductInfoDO>()
                .eq(ProductInfoDO::getProductType, productType)
                .eq(ProductInfoDO::getBundleType, bundleType));
    }
}
```

#### 5.2 æ–°å¢ ProductBundleRelationMapper

```java
package cn.iocoder.yudao.module.dm.dal.mysql.product;

import cn.iocoder.yudao.framework.mybatis.core.mapper.BaseMapperX;
import cn.iocoder.yudao.module.dm.dal.dataobject.product.ProductBundleRelationDO;
import org.apache.ibatis.annotations.Mapper;
import java.util.List;

/**
 * äº§å“ç»„åˆå…³ç³» Mapper
 *
 * @author zeno
 */
@Mapper
public interface ProductBundleRelationMapper extends BaseMapperX<ProductBundleRelationDO> {

    /**
     * æ ¹æ®ç»„åˆäº§å“IDæŸ¥è¯¢æ˜ç»†åˆ—è¡¨
     */
    default List<ProductBundleRelationDO> selectListByBundleProductId(Long bundleProductId) {
        return selectList(ProductBundleRelationDO::getBundleProductId, bundleProductId);
    }

    /**
     * æ ¹æ®ç»„åˆäº§å“IDåˆ é™¤æ˜ç»†
     */
    default void deleteByBundleProductId(Long bundleProductId) {
        delete(ProductBundleRelationDO::getBundleProductId, bundleProductId);
    }
    
    /**
     * æ ¹æ®å­äº§å“IDæŸ¥è¯¢å…³è”å…³ç³»ï¼ˆç”¨äºçº§è”æŸ¥è¯¢ï¼‰
     */
    default List<ProductBundleRelationDO> selectListBySubProductId(Long subProductId) {
        return selectList(ProductBundleRelationDO::getSubProductId, subProductId);
    }
}
```

---

### å…­ã€Controllerå±‚ï¼ˆæ‰©å±•ç°æœ‰ProductInfoControllerï¼‰

```java
@Tag(name = "ç®¡ç†åå° - äº§å“ä¿¡æ¯")
@RestController
@RequestMapping("/dm/product-info")
@Validated
@Slf4j
public class ProductInfoController {

    @Resource
    private ProductInfoService productInfoService;

    // ========== ç°æœ‰æ–¹æ³•ä¿æŒä¸å˜ ==========
    // createProductInfo, updateProductInfo, deleteProductInfo...
    // è¿™äº›æ–¹æ³•å†…éƒ¨é€»è¾‘å·²ç»æ”¯æŒç»„åˆäº§å“

    // ========== æ–°å¢ï¼šç»„åˆäº§å“ä¸“ç”¨æ–¹æ³• ==========

    @GetMapping("/bundle-relations")
    @Operation(summary = "è·å–ç»„åˆäº§å“æ˜ç»†åˆ—è¡¨")
    @Parameter(name = "bundleProductId", description = "ç»„åˆäº§å“ID", required = true)
    @PreAuthorize("@ss.hasPermission('dm:product-info:query')")
    public CommonResult<List<ProductBundleRelationDO>> getBundleRelations(
            @RequestParam("bundleProductId") Long bundleProductId) {
        return success(productInfoService.getBundleRelations(bundleProductId));
    }

    @PutMapping("/recalculate-bundle-cost")
    @Operation(summary = "é‡æ–°è®¡ç®—ç»„åˆäº§å“æˆæœ¬ä»·")
    @Parameter(name = "bundleProductId", description = "ç»„åˆäº§å“ID", required = true)
    @PreAuthorize("@ss.hasPermission('dm:product-info:update')")
    public CommonResult<Boolean> recalculateBundleCostPrice(
            @RequestParam("bundleProductId") Long bundleProductId) {
        productInfoService.recalculateBundleCostPrice(bundleProductId);
        return success(true);
    }

    @PutMapping("/batch-recalculate-bundle-cost")
    @Operation(summary = "æ‰¹é‡é‡æ–°è®¡ç®—ç»„åˆäº§å“æˆæœ¬ä»·")
    @PreAuthorize("@ss.hasPermission('dm:product-info:update')")
    public CommonResult<Boolean> batchRecalculateBundleCostPrice() {
        productInfoService.batchRecalculateBundleCostPrice();
        return success(true);
    }
}
```

---

### ä¸ƒã€æ•°æ®åº“å˜æ›´æ€»ç»“

```sql
-- ========== æ­¥éª¤1ï¼šä¿®æ”¹ç°æœ‰è¡¨ï¼ˆåªéœ€2ä¸ªå­—æ®µï¼ï¼‰ ==========
ALTER TABLE `dm_product_info` 
ADD COLUMN `product_type` int DEFAULT 0 COMMENT 'äº§å“ç±»å‹ï¼š0=æ™®é€šäº§å“ 1=ç»„åˆäº§å“',
ADD COLUMN `bundle_type` int DEFAULT NULL COMMENT 'ç»„åˆç±»å‹ï¼š1=è‡ªå®šä¹‰æˆæœ¬ä»· 2=è‡ªåŠ¨ç´¯è®¡æˆæœ¬ä»·',
ADD INDEX `idx_product_type` (`product_type`, `deleted`);

-- æ³¨æ„ï¼šcost_price å­—æ®µå¤ç”¨ï¼Œæ— éœ€æ–°å¢é¢å¤–æˆæœ¬ä»·å­—æ®µ

-- ========== æ­¥éª¤2ï¼šæ–°å¢å…³è”è¡¨ï¼ˆ1å¼ è¡¨ï¼Œç²¾ç®€ç‰ˆï¼‰==========
CREATE TABLE `dm_product_bundle_relation` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  
  -- å…³è”å…³ç³»ï¼ˆæ ¸å¿ƒå­—æ®µï¼‰
  `bundle_product_id` bigint NOT NULL COMMENT 'ç»„åˆäº§å“ID',
  `sub_product_id` bigint NOT NULL COMMENT 'å­äº§å“ID',
  
  -- ç»„åˆé…ç½®
  `quantity` int NOT NULL DEFAULT 1 COMMENT 'æ•°é‡',
  `sort_order` int DEFAULT 0 COMMENT 'æ’åº',
  `remark` varchar(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
  
  -- å®¡è®¡å­—æ®µ
  `creator` varchar(64) DEFAULT NULL COMMENT 'åˆ›å»ºäºº',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updater` varchar(64) DEFAULT NULL COMMENT 'æ›´æ–°äºº',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `deleted` bit(1) NOT NULL DEFAULT b'0' COMMENT 'æ˜¯å¦åˆ é™¤',
  `tenant_id` bigint DEFAULT 0 COMMENT 'ç§Ÿæˆ·ID',
  
  PRIMARY KEY (`id`),
  KEY `idx_bundle_product` (`bundle_product_id`, `deleted`),
  KEY `idx_sub_product` (`sub_product_id`),
  KEY `idx_tenant` (`tenant_id`, `deleted`),
  UNIQUE KEY `uk_bundle_sub` (`bundle_product_id`, `sub_product_id`, `deleted`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COMMENT='äº§å“ç»„åˆå…³ç³»è¡¨';

-- æ³¨æ„ï¼šä¸å­˜å‚¨å­äº§å“çš„å†—ä½™æ•°æ®ï¼ˆSKUã€åç§°ã€å•ä»·ç­‰ï¼‰ï¼ŒæŸ¥è¯¢æ—¶å®æ—¶JOINè·å–
```

**æ€»ç»“ï¼š**
- âœ… åªä¿®æ”¹1å¼ ç°æœ‰è¡¨ï¼Œ**ä»…å¢åŠ 2ä¸ªå­—æ®µ**
- âœ… åªæ–°å¢1å¼ å…³è”è¡¨
- âœ… **æœ€å°åŒ–æ•°æ®åº“å˜æ›´**

---

### å…«ã€ä½¿ç”¨ç¤ºä¾‹

#### 8.1 åˆ›å»ºç»„åˆäº§å“ï¼ˆè‡ªåŠ¨ç´¯è®¡æ¨¡å¼ï¼‰

```json
POST /dm/product-info/create

{
  "skuId": "COMBO-001",
  "skuName": "é”…å…·5ä»¶å¥—",
  "modelNumber": "COMBO-001",
  "unit": "å¥—",
  "productType": 1,           // ç»„åˆäº§å“
  "bundleType": 2,            // è‡ªåŠ¨ç´¯è®¡ï¼ˆç³»ç»Ÿè‡ªåŠ¨è®¡ç®—costPriceï¼‰
  "bundleItems": [
    {
      "subProductId": 5,      // ç‰›æ’æœº
      "quantity": 2
    },
    {
      "subProductId": 7,      // å å é”…
      "quantity": 1
    }
  ],
  "categoryId": 1,
  "brandId": 1,
  "description": "ç»„åˆå¥—é¤"
}

// ç»“æœï¼š
// cost_price = 118*2 + 159*1 = 395ï¼ˆç³»ç»Ÿè‡ªåŠ¨è®¡ç®—å¹¶ä¿å­˜ï¼‰
```

#### 8.2 åˆ›å»ºç»„åˆäº§å“ï¼ˆè‡ªå®šä¹‰æ¨¡å¼ï¼‰

```json
POST /dm/product-info/create

{
  "skuId": "COMBO-002",
  "skuName": "ç‰¹æƒ å¥—è£…",
  "modelNumber": "COMBO-002",
  "productType": 1,           // ç»„åˆäº§å“
  "bundleType": 1,            // è‡ªå®šä¹‰
  "costPrice": 300.00,        // ç”¨æˆ·æ‰‹åŠ¨æŒ‡å®šå›ºå®šæˆæœ¬ä»·
  "bundleItems": [
    {
      "subProductId": 5,
      "quantity": 2
    },
    {
      "subProductId": 7,
      "quantity": 1
    }
  ]
}

// ç»“æœï¼š
// cost_price = 300ï¼ˆç”¨æˆ·æ‰‹åŠ¨è®¾ç½®ï¼Œä¸è‡ªåŠ¨è®¡ç®—ï¼‰
```

#### 8.3 æŸ¥è¯¢ç»„åˆäº§å“

```json
GET /dm/product-info/get?id=100

// å“åº”ï¼š
{
  "id": 100,
  "skuId": "COMBO-001",
  "skuName": "é”…å…·5ä»¶å¥—",
  "productType": 1,
  "bundleType": 2,
  "costPrice": 395.00,  // è‡ªåŠ¨è®¡ç®—çš„æˆæœ¬ä»·
  "bundleItems": [
    {
      "subProductId": 5,
      "subSkuId": "210-Gray",
      "subSkuName": "ç‰›æ’æœº",
      "quantity": 2,
      "unitCostPrice": 118.00,
      "totalCostPrice": 236.00
    },
    {
      "subProductId": 7,
      "subSkuId": "261-White-5P",
      "subSkuName": "å¯æ‹†å¸æ‰‹æŸ„é”…å å é”…",
      "quantity": 1,
      "unitCostPrice": 159.00,
      "totalCostPrice": 159.00
    }
  ]
}
```

---

### ä¹ã€ä¼˜åŠ¿æ€»ç»“

âœ… **æœ€å°åŒ–æ”¹åŠ¨**
- åªä¿®æ”¹1å¼ ç°æœ‰è¡¨ï¼ˆå¢åŠ 4ä¸ªå­—æ®µï¼‰
- åªæ–°å¢1å¼ å…³è”è¡¨
- ä¸å½±å“ç°æœ‰ä¸šåŠ¡é€»è¾‘

âœ… **å¤ç”¨ç°æœ‰åŠŸèƒ½**
- ç»„åˆäº§å“å¯ä»¥ä½¿ç”¨åˆ†ç±»ã€å“ç‰Œã€ä¾›åº”å•†ç­‰æ‰€æœ‰åŠŸèƒ½
- å¯ä»¥ä½¿ç”¨ç°æœ‰çš„æˆæœ¬ç»“æ„ç®¡ç†ï¼ˆdm_product_costsï¼‰
- å¯ä»¥ä½¿ç”¨ç°æœ‰çš„é‡‡è´­ã€é”€å”®æµç¨‹

âœ… **çµæ´»æ€§é«˜**
- æ”¯æŒè‡ªå®šä¹‰å’Œè‡ªåŠ¨ç´¯è®¡ä¸¤ç§æ¨¡å¼
- æ”¯æŒå®šæ—¶åŒæ­¥æˆæœ¬ä»·
- æ˜“äºæ‰©å±•

âœ… **æ•°æ®ä¸€è‡´æ€§**
- äº‹åŠ¡ä¿è¯
- å¿«ç…§æœºåˆ¶
- çº§è”åˆ é™¤

---

## æ–¹æ¡ˆäºŒï¼šå®Œå…¨ä¸å¢åŠ è¡¨ï¼ˆJSONæ–¹æ¡ˆï¼‰- ä¸æ¨è

å¦‚æœçœŸçš„ä¸èƒ½æ–°å¢è¡¨ï¼Œå¯ä»¥ä½¿ç”¨JSONå­—æ®µæ–¹æ¡ˆï¼š

```sql
-- åªä¿®æ”¹ dm_product_info è¡¨
ALTER TABLE `dm_product_info` 
ADD COLUMN `product_type` int DEFAULT 0 COMMENT 'äº§å“ç±»å‹ï¼š0=æ™®é€š 1=ç»„åˆ',
ADD COLUMN `bundle_type` int DEFAULT NULL COMMENT 'ç»„åˆç±»å‹ï¼š1=è‡ªå®šä¹‰ 2=è‡ªåŠ¨ç´¯è®¡',
ADD COLUMN `bundle_items_json` json DEFAULT NULL COMMENT 'ç»„åˆæ˜ç»†JSONï¼š[{subProductId, quantity, unitCost, totalCost}]';

-- è¯´æ˜ï¼šcost_price å­—æ®µå­˜å‚¨æœ€ç»ˆæˆæœ¬ä»·
```

**ç¼ºç‚¹ï¼š**
- âŒ æ— æ³•å»ºç«‹å¤–é”®çº¦æŸ
- âŒ æŸ¥è¯¢æ€§èƒ½å·®
- âŒ æ•°æ®ä¸€è‡´æ€§éš¾ä»¥ä¿è¯
- âŒ æ— æ³•é€šè¿‡SQLç›´æ¥æŸ¥è¯¢å­äº§å“
- âŒ ç»´æŠ¤å›°éš¾

**ä»…åœ¨æœ‰æç‰¹æ®Šé™åˆ¶æ—¶è€ƒè™‘æ­¤æ–¹æ¡ˆ**

---

## æ€»ç»“

**æ¨èä½¿ç”¨æ–¹æ¡ˆä¸€**ï¼š
- ğŸ“Œ åªä¿®æ”¹1å¼ è¡¨ï¼Œåªå¢åŠ 1å¼ æ–°è¡¨
- ğŸ“Œ æœ€å°åŒ–æ”¹åŠ¨ï¼Œæœ€å¤§åŒ–å¤ç”¨
- ğŸ“Œ æ•°æ®ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤
- ğŸ“Œ æ€§èƒ½ä¼˜ç§€ï¼Œæ‰©å±•æ€§å¼º

è¿™æ˜¯åœ¨"ä¸å¢åŠ å¤ªå¤šè¡¨"å’Œ"åŠŸèƒ½å®Œå–„"ä¹‹é—´çš„æœ€ä½³å¹³è¡¡ç‚¹ï¼

